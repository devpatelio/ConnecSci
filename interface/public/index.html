<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <link rel="stylesheet" href="index.css" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>React App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <script type="text/javascript" src="https://d3js.org/d3.v2.js"></script>

    <div style="display: flex">
      <div id="dataviz-container"></div>
      <div id="main" style="width: 100%">
        <input
          placeholder="Search for Research"
          onchange="this.value.length > 0 ? updateSearch(this.value) : selectedItem('Name', 1)"
          style="
            padding: 10px;
            min-width: 400px;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS',
              sans-serif;
            border-radius: 8px;
            border: 1px solid #7d7d7d;
          "
        />
        <div id="search-results"></div>
        <div style="display: flex; align-items: center; gap: 4px">
          <h1 id="paper-name">Name</h1>
          (<span id="paper-description">Description</span>)
        </div>
        <div style="display: flex; gap: 20px">
          <p id="paper-link" class="paper-link" style="font-size: 20px">
            Read Here
          </p>
          <p class="paper-link" style="font-size: 20px">Read Here</p>
        </div>
        <p id="paper-abstract" style="font-size: 19px">
          Abstract goes here. Lorem ipsum dolor. Lorem ipsum dolor. Lorem ipsum
          dolor. Lorem ipsum dolor. Lorem ipsum dolor. Lorem ipsum dolor. Lorem
          ipsum dolor. Lorem ipsum dolor. Lorem ipsum dolor. Lorem ipsum dolor.
          Lorem ipsum dolor. Lorem ipsum dolor. Lorem ipsum dolor. Lorem ipsum
          dolor. Lorem ipsum dolor. Lorem ipsum dolor. Lorem ipsum dolor. Lorem
          ipsum dolor. Lorem ipsum dolor.
        </p>
        <br />
        <hr />
        <br /><br />
        <div style="display: flex; gap: 15px">
          <div
            style="
              background-color: lightgrey;
              width: 40%;
              height: 100px;
              display: flex;
              flex-direction: column;
              justify-content: center;
              border-radius: 10px;
            "
          >
            QF Info 1
          </div>
          <div
            style="
              background-color: lightgrey;
              width: 40%;
              height: 100px;
              display: flex;
              flex-direction: column;
              justify-content: center;
              border-radius: 10px;
            "
          >
            QF Info 2
          </div>
        </div>
        <div>
          <div></div>
          <div></div>
        </div>
      </div>
    </div>
  </body>
</html>

<style>
  body {
    color: rgb(15, 15, 15);
    background: white;
  }

  .link {
    stroke: #ccc;
  }

  .node-text {
    pointer-events: none;
    font: 10px sans-serif;
  }
  #main {
    padding: 50px 120px;
  }

  .paper-link {
    background-color: lightgrey;
    padding: 7px 25px;
    border-radius: 10px;
    width: 100px;
    display: flex;
    justify-content: center;
    border: none;
  }
</style>

<script>
  var h = 1040, w = 900;

  let search = '';
  let searchResults = [];
  
  function updateSearch(input) {
    searchResults = [];
    for (let i = 0; i < json.nodes.length; i++)
    if (json.nodes[i].name.includes(input) || json.nodes[i].abstract.includes(input) || json.nodes[i].citations.includes(input)) {
      searchResults.push(json.nodes[i].name)
    }
    console.log(searchResults.slice(0, 10))

    document.getElementById('search-results').innerHTML = searchResults.map((item, index) => 
    `<ul>
      <li>${item}</li>
    </ul>`
    ).join('')

  }

  var svg = d3
    .select("div#dataviz-container")
    .append("svg:svg")
    .attr("width", w)
    .attr("height", h);

  d3.json("index.json", function (json) {
    var force = (self.force = d3.layout
      .force()
      .nodes(json.nodes)
      .links(json.links)
      .gravity(0.05)
      .distance(300)
      .charge(-200)
      .size([w, h])
      .start());

    var node_drag = d3.behavior
      .drag()
      .on("dragstart", dragstart)
      .on("drag", dragmove)
      .on("dragend", dragend);

    function dragstart(d, i) {
      force.stop();
    }

    function dragmove(d, i) {
      d.px += d3.event.dx;
      d.py += d3.event.dy;
      d.x += d3.event.dx;
      d.y += d3.event.dy;
      tick();
    }

    function dragend(d, i) {
      d.fixed = true;
      tick();
      force.resume();
      selectedItem(d.name, i, d.abstract);
      node.append("svg:circle").style("fill", "green");
    }

    function selectedItem(name, deets, abstract) {
      document.getElementById("paper-name").innerHTML = name;
      document.getElementById("paper-description").innerHTML = deets;
      document.getElementById("paper-abstract").innerHTML = abstract;
    }

    var link = svg
      .selectAll("line.link")
      .data(json.links)
      .enter()
      .append("svg:line")
      .attr("class", "link")
      .attr("x1", function (d) {
        return d.source.x;
      })
      .attr("y1", function (d) {
        return d.source.y;
      })
      .attr("x2", function (d) {
        return d.target.x;
      })
      .attr("y2", function (d) {
        return d.target.y;
      });

    var node = svg
      .selectAll("g.node")
      .data(json.nodes)
      .enter()
      .append("svg:g")
      .attr("class", "node")
      .call(node_drag);

    node
      .append("svg:text")
      .attr("class", "node-text")
      .attr("dx", 12)
      .attr("dy", ".35em")
      .text(function (d) {
        return `${d.name.slice(0, 20)}...`;
      });

    node
      .append("svg:circle")
      .attr("cx", 0)
      .attr("cy", 0)
      .attr("r", function (d) {
        return d.weight;
      })
      .style("fill", "black")
      .attr("stroke", "white");

    force.on("tick", tick);

    function tick() {
      link
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y;
        })
        .attr("x2", function (d) {
          return d.target.x;
        })
        .attr("y2", function (d) {
          return d.target.y;
        });
      node.attr("transform", function (d) {
        return "translate(" + d.x + "," + d.y + ")";
      });
    }
  });
  
</script>